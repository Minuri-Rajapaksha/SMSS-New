<?xml version="1.0" encoding="utf-8" ?>

<scripts>

	<!--<scripts countMedicalCasualLeaves1=" SELECT SUM(DATEDIFF(END_DATE,START_DATE)+1) AS COUNT FROM
			LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@teacherID' AND LEAVE_TYPE_ID='@leaveType' AND STATUS=2 AND
			YEAR(END_DATE) = YEAR(CURDATE()) AND YEAR(START_DATE) = YEAR(CURDATE()) " />

	<scripts countMedicalCasualLeaves2=" SELECT SUM(DATEDIFF(LAST_DAY(CURDATE()),START_DATE)+1) AS COUNT FROM
			LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@teacherID' AND LEAVE_TYPE_ID='@leaveType' AND STATUS=2 AND
			YEAR(END_DATE) != YEAR(CURDATE()) AND YEAR(START_DATE) = YEAR(CURDATE()) " />

	<scripts countMedicalCasualLeaves3=" SELECT SUM(DATEDIFF(END_DATE,DATE_ADD(LAST_DAY(DATE_SUB(CURDATE(), INTERVAL 30 DAY)), INTERVAL 1 DAY))+1) AS COUNT FROM
			LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@teacherID' AND LEAVE_TYPE_ID='@leaveType' AND STATUS=2 AND
			YEAR(END_DATE) = YEAR(CURDATE()) AND YEAR(START_DATE) != YEAR(CURDATE()) " />-->
	
	

	<!--<scripts countMedicalCasualLeavesNewForFullday=" SELECT CEIL(SUM(DURATION)) AS COUNT FROM
			LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@teacherID' AND LEAVE_TYPE_ID='@leaveType' AND STATUS=2 AND
			(YEAR(END_DATE) = YEAR(CURDATE()) OR YEAR(START_DATE) = YEAR(CURDATE())) " />

	<scripts countMedicalCasualLeavesNewForHalfAndShort=" SELECT SUM(DURATION) AS COUNT FROM
			LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@teacherID' AND LEAVE_TYPE_ID='@leaveType' AND STATUS=2 AND
			(YEAR(END_DATE) = YEAR(CURDATE()) OR YEAR(START_DATE) = YEAR(CURDATE())) " />-->
	
	<scripts maxMedi=" SELECT MAX_DAYS  FROM LEAVE_TYPE WHERE LEAVE_TYPE_ID = 'MED' " />

	<scripts maxCas=" SELECT MAX_DAYS  FROM LEAVE_TYPE WHERE LEAVE_TYPE_ID = 'CAS' " />

	<scripts addLeave=" INSERT INTO LEAVE_APPLICATION_FORM
			(TEACHER_ID, LEAVE_ID, START_DATE, END_DATE, DURATION, REASON, STATUS, LEAVE_TYPE_ID, LEAVE_CATEGORY_ID, ABSENT_TIME_PERIOD)
			VALUES
			('@TEACHER_ID', '@LEAVE_ID', DATE_FORMAT('@START_DATE','%y/%m/%d'), DATE_FORMAT('@END_DATE','%y/%m/%d'), 
			CAST('@DURATION' AS DECIMAL(10,6)),  '@REASON', CAST('@STATUS' AS SIGNED INTEGER) , '@LEAVE_TYPE_ID', '@LEAVE_CATEGORY_ID', '@ABSENT_TIME_PERIOD') "/>

	<scripts getLeaveId=" SELECT MAX(CAST(LEAVE_ID AS SIGNED)) AS LEAVE_ID FROM LEAVE_APPLICATION_FORM WHERE TEACHER_ID='@TEACHER_ID' " />

	<scripts checkLeaveRequestedEarlier="SELECT LEAVE_ID FROM LEAVE_APPLICATION_FORM WHERE 
			 (DATE_FORMAT('@REQUESTING_DATE','%y/%m/%d') BETWEEN START_DATE AND END_DATE) AND TEACHER_ID='@TEACHER_ID' " />

	<!--<scripts checkFullLeaveRequestedEarlier="SELECT LEAVE_ID FROM LEAVE_APPLICATION_FORM 
			 WHERE (('@REQUESTING_FROM_DATE' BETWEEN START_DATE AND END_DATE) || ('@REQUESTING_TO_DATE' BETWEEN START_DATE AND END_DATE)) 
			 AND TEACHER_ID='@TEACHER_ID' " />-->

	<scripts checkWhetherHoliday=" SELECT  HOLIDAY_NAME FROM CALENDAR_HOLIDAYS
			WHERE ('@REQUESTING_DATE' BETWEEN HOLIDAY_FROM AND HOLIDAY_TO) " />

	<scripts loadTeacherRequestedLeaves=" SELECT L.LEAVE_ID, DATE_FORMAT(L.START_DATE,'%y/%m/%d') AS START_DATE, 
			 DATE_FORMAT(L.END_DATE,'%y/%m/%d') AS END_DATE, ROUND(L.DURATION, 2) AS DURATION, L.REASON,
			( CASE L.STATUS  
				WHEN 0 THEN 'Pending' 
				WHEN 1 THEN 'Rejected' 
				WHEN 2 THEN 'Approved' END) AS LEAVE_STATUS,
			T.LEAVE_TYPE_NAME,
			( CASE L.LEAVE_CATEGORY_ID  
				WHEN 'FULL' THEN 'Fullday' 
				WHEN 'HALF_MOR' THEN 'Halfday Morning' 
				WHEN 'HALF_EVE' THEN 'Halfday Evening' 
				WHEN 'SHORT' THEN 'Short Leave' END) AS LEAVE_CATEGORY 
			FROM LEAVE_APPLICATION_FORM L
			INNER JOIN LEAVE_TYPE T
			ON L.LEAVE_TYPE_ID = T.LEAVE_TYPE_ID
			WHERE L.TEACHER_ID = '@teacherID' AND START_DATE >= CURDATE()
			ORDER BY (CAST(L.LEAVE_ID AS SIGNED)) ASC " />

	<scripts deleteLeave=" DELETE FROM LEAVE_APPLICATION_FORM WHERE LEAVE_ID=CAST('@LEAVE_ID' AS DECIMAL(10,6)) AND TEACHER_ID='@TEACHER_ID' " />

	<scripts loadRequestedLeavesToVPrincipal=" SELECT L.LEAVE_ID, L.TEACHER_ID, U.FULL_NAME, 
			 DATE_FORMAT(L.START_DATE,'%y/%m/%d') AS START_DATE, DATE_FORMAT(L.END_DATE,'%y/%m/%d') AS END_DATE, L.DURATION, L.REASON,
			( CASE L.STATUS  
				WHEN 0 THEN 'Pending' 
				WHEN 1 THEN 'Rejected' 
				WHEN 2 THEN 'Approved' END) AS LEAVE_STATUS,
			T.LEAVE_TYPE_NAME,
			( CASE L.LEAVE_CATEGORY_ID  
				WHEN 'FULL' THEN 'Fullday' 
				WHEN 'HALF_MOR' THEN 'Halfday Morning' 
				WHEN 'HALF_EVE' THEN 'Halfday Evening' 
				WHEN 'SHORT' THEN 'Short Leave' END) AS LEAVE_CATEGORY 
			FROM LEAVE_APPLICATION_FORM L
			INNER JOIN LEAVE_TYPE T
			ON L.LEAVE_TYPE_ID = T.LEAVE_TYPE_ID
			INNER JOIN USER U
			ON L.TEACHER_ID = U.USER_NAME
			ORDER BY (CAST(L.LEAVE_ID AS SIGNED)) ASC " />

	<scripts updateLeaveStatus=" UPDATE LEAVE_APPLICATION_FORM SET STATUS = CAST('@STATUS' AS DECIMAL(10,6)) WHERE TEACHER_ID='@TEACHER_ID' AND LEAVE_ID='@LEAVE_ID' "/>

	<scripts countAvailablePendingLeaves="SELECT
	(
		SELECT (SUM(DURATION))   FROM
		LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@TEACHERID' AND LEAVE_TYPE_ID='CAS' AND STATUS=2 AND
		(YEAR(END_DATE) = YEAR(CURDATE()) OR YEAR(START_DATE) = YEAR(CURDATE()))
	) AS CASUALTAKEN,
	(
		SELECT (SUM(DURATION))   FROM
		LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@TEACHERID' AND LEAVE_TYPE_ID='MED' AND STATUS=2 AND
		(YEAR(END_DATE) = YEAR(CURDATE()) OR YEAR(START_DATE) = YEAR(CURDATE()))
	)AS MEDICALTAKEN,
	(
		SELECT (SUM(DURATION))  FROM
		LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@TEACHERID' AND LEAVE_TYPE_ID='CAS' AND STATUS=0 AND
		(YEAR(END_DATE) = YEAR(CURDATE()) OR YEAR(START_DATE) = YEAR(CURDATE()))
	) AS CASUALPENDING,
	(
		SELECT (SUM(DURATION))   FROM
		LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@TEACHERID' AND LEAVE_TYPE_ID='MED' AND STATUS=0 AND
		(YEAR(END_DATE) = YEAR(CURDATE()) OR YEAR(START_DATE) = YEAR(CURDATE()))
	) AS MEDICALPENDING,
	(
		SELECT (SUM(DURATION))   FROM
		LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@TEACHERID' AND LEAVE_TYPE_ID='DUT' AND STATUS=0 AND
		(YEAR(END_DATE) = YEAR(CURDATE()) OR YEAR(START_DATE) = YEAR(CURDATE()))
	) AS DUTYPENDING,
	(
		SELECT (SUM(DURATION))   FROM
		LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@TEACHERID' AND LEAVE_TYPE_ID='NOP' AND STATUS=0 AND
		(YEAR(END_DATE) = YEAR(CURDATE()) OR YEAR(START_DATE) = YEAR(CURDATE()))
	) AS NOPAYPENDING" />


	<scripts validateWhetherMoreThanThreeForParticularDay=" SELECT LEAVE_ID FROM LEAVE_APPLICATION_FORM 
			 WHERE START_DATE = DATE_FORMAT('@REQUESTING_DATE','%y/%m/%d') AND STATUS = 2 
			 AND LEAVE_CATEGORY_ID='SHORT' " />

	<scripts countAvailableForSpecialMedical="SELECT
		(SELECT (SUM(DURATION))   FROM
		LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@TEACHERID' AND LEAVE_TYPE_ID='MED' AND STATUS=2 AND
		(YEAR(END_DATE) = YEAR(CURDATE()) OR YEAR(START_DATE) = YEAR(CURDATE()))
	    ) AS CURRENTAVAILABLE,
		(
		SELECT (SUM(DURATION))   FROM
		LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@TEACHERID' AND LEAVE_TYPE_ID='MED' AND STATUS=0 AND
		(YEAR(END_DATE) = YEAR(CURDATE()) OR YEAR(START_DATE) = YEAR(CURDATE()))
		) AS CURRENTPENDING,
		(
		SELECT (SUM(DURATION))   FROM
		LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@TEACHERID' AND LEAVE_TYPE_ID='MED' AND STATUS=2 AND
		(YEAR(END_DATE) = (YEAR(CURDATE())-1) OR YEAR(START_DATE) = (YEAR(CURDATE()))-1)
		) AS BEFOREYEARAVAILABLE,
		(
		SELECT (SUM(DURATION))   FROM
		LEAVE_APPLICATION_FORM WHERE TEACHER_ID = '@TEACHERID' AND LEAVE_TYPE_ID='MED' AND STATUS=2 AND
		(YEAR(END_DATE) = (YEAR(CURDATE())-2) OR YEAR(START_DATE) = (YEAR(CURDATE()))-2)
		) AS BEFORETWOYEARAVAILABLE " />

	<scripts validateWhetherMoreThanTwoForMonth=" SELECT * FROM LEAVE_APPLICATION_FORM WHERE TEACHER_ID='@TEACHERID' 
			 AND LEAVE_CATEGORY_ID='SHORT' AND MONTH (DATE_FORMAT('@REQUEST_DATE','%y/%m/%d'))=MONTH(START_DATE) " />

	<!--<scripts countMedicalAndCasualLeaves =" select MLC_NUM_LEAVES_YEARCUR, CLC_NUM_LEAVES from 
			 medical_leave_count as M,casual_leave_count as C
			where M.TEACHER_ID = '@teacherID' and M.MLC_CURRENT_YEAR = '@Year' and 
			C.TEACHER_ID = '@teacherID' and C.CLC_YEAR = '@Year'" />

	<scripts addFullDayLeaveToDB =" INSERT INTO leaves (LEAVE_ID, LEAVE_TYPE_ID, TEACHER_ID, LEAVE_SUBMITTED_DATE, 
			 LEAVE_FROM_DATE, LEAVE_TO_DATE, LEAVE_CASUAL_MEDICAL, LEAVE_MORNING_EVENING, LEAVE_DESCRIPTION, LEAVE_STATUS)
			VALUES ('@leaveID', '2', '@teacherID', now(), '@fromDate', '@toDate' , '@casualOmedical', '@descrip', '0') " />

	<scripts loadDataToGrid = "select '2013-06-15 14:25:18' AS 'APPLIED_DATE', 'Full Day' AS 'LEAVE_TYPE', '2013-06-15 14:25:18' AS 'REQUESTED_DATE', 'Sick' AS 'REASON', 'Approved' AS 'LEAVE_STATUS' from leaves" />

	<scripts loadTeacherTTable = "SELECT * FROM temporytimetable" />

	<scripts loadStudentTTable = "SELECT * FROM tempotyttablestudent" />

	<scripts loadSubsTTable = "SELECT * from relief " />

	<scripts vicePrinLeaveHand = "SELECT 'R.N.Pathumi' as 'Teacher Name', startdate, enddate, 'Casual' as 'Leave type', reason, 'Pending' as 'status', 'Full Day' as 'Leave Subtype', 'Approve' as 'Approve', 'Reject' as 'Reject' FROM leaves" />-->


</scripts>